<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AC03 - Políticas iptables | Erik De La Rosa</title>
    <link rel="stylesheet" href="../../assets/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>
    <header class="topbar">
        <div class="container topbar__inner">
            <div class="brand">
                <a href="../../index.html" class="back-link">← Volver al inicio</a>
            </div>
        </div>
        <div class="scanline" aria-hidden="true"></div>
    </header>

    <main class="article" id="pdf-content">
        <header class="article__header">
            <div class="article__meta">
                <span>CNO V - Seguridad Informática</span>
                <span>•</span>
                <span>Primer Parcial</span>
                <span>•</span>
                <span>Actividad 03</span>
            </div>
            <h1>Interpretación y traducción de políticas de filtrado en iptables</h1>
            <p class="lead">Configuración de firewalls en Linux mediante Netfilter/iptables: sintaxis, cadenas y
                políticas por defecto.</p>
        </header>

        <section class="article__content">

            <h2>1. Introducción</h2>
            <p>
                El filtrado de paquetes es la primera línea de defensa en la seguridad de redes host-based.
                En sistemas Linux, <strong>iptables</strong> es la herramienta de espacio de usuario tradicional para
                interactuar
                con el framework Netfilter del kernel.
            </p>
            <p>
                Esta actividad se centra en la sintaxis de las reglas, la lógica de las cadenas (INPUT, OUTPUT, FORWARD)
                y la importancia de establecer una política por defecto restrictiva (DROP) frente a una permisiva
                (ACCEPT).
            </p>

            <h2>2. Desarrollo Técnico</h2>

            <h3>Estructura de una Regla</h3>
            <p>
                Una regla de iptables se compone de una tabla (por defecto 'filter'), una cadena, criterios de
                coincidencia (matchers) y un objetivo (target).
            </p>

            <div class="code-block">
                # Sintaxis General
                iptables -t [tabla] -[A|I|D] [CADENA] [criterios] -j [OBJETIVO]

                # Ejemplo: Permitir tráfico SSH entrante
                iptables -A INPUT -p tcp --dport 22 -j ACCEPT
            </div>

            <h3>Caso Práctico: Configuración de un Bastión</h3>
            <p>
                A continuación se muestra un script de configuración básico para un servidor web, aplicando el principio
                de "todo lo que no está explícitamente permitido, está prohibido".
            </p>

            <div class="code-block">
                #!/bin/bash

                # 1. Limpiar reglas existentes
                iptables -F
                iptables -X

                # 2. Establecer Políticas por Defecto (Deny All)
                iptables -P INPUT DROP
                iptables -P FORWARD DROP
                iptables -P OUTPUT ACCEPT

                # 3. Permitir tráfico de loopback
                iptables -A INPUT -i lo -j ACCEPT

                # 4. Permitir conexiones establecidas y relacionadas
                iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

                # 5. Permitir SSH (Gestión) y HTTP/HTTPS (Servicio)
                iptables -A INPUT -p tcp --dport 22 -j ACCEPT
                iptables -A INPUT -p tcp --dport 80 -j ACCEPT
                iptables -A INPUT -p tcp --dport 443 -j ACCEPT

                # Loguear paquetes descartados (opcional, para depuración)
                iptables -A INPUT -j LOG --log-prefix "IPTABLES-DROP: "
            </div>

            <h2>3. Material Multimedia</h2>

            <figure class="figure">
                <img src="https://mermaid.ink/img/pako:eNpVkM1qwzAQhF9F7KmF_AGHHHzIobSXQkl7KGS1sSWw1JKsOIT8965jp4fSnuZjdma1g7K9j9qRfN63Sn8ZD0rPlrTj5B37I3sk7woopWEIE_xJenTWeyWHoVOWv07fCSX9V7_ppdh8PlbisX74lNYatMYHDWd1vf70W3FwOE1413DcaengqVP-f8PlvQ8OLuFhB2fwtOAk4TnhTf6S8JrwNnsjvCV8y94J7wmPeU_CE96X7IT3hCe8KzgpOEl4STgpHCU8S3hOOCkcJbwkPCscJbwknBSOEp4lPCccJawj5X_COtxOFEVpxweson4A1gB0fQ?type=png"
                    alt="Flujo de paquetes en Netfilter">
                <figcaption>Fig 1. Diagrama del flujo de un paquete a través de las cadenas de la tabla FILTER.
                </figcaption>
            </figure>

            <h2>4. Reflexión Personal</h2>
            <div class="reflection">
                <h3>Stateful vs Stateless</h3>
                <p>
                    La gran potencia de iptables radica en su módulo `conntrack`, que permite el filtrado con estado
                    (stateful).
                    A diferencia de las ACLs tradicionales de routers antiguos, iptables puede tomar decisiones
                    basándose en si un paquete pertenece
                    a una conexión ya válida.
                </p>
                <p>
                    El comando <code>-m state --state ESTABLISHED,RELATED</code> es crítico; sin él, tendríamos que
                    abrir reglas estáticas para
                    todos los puertos efímeros de respuesta, lo cual sería una pesadilla de seguridad y gestión.
                </p>
            </div>

            <div class="references">
                <h3>5. Referencias Técnicas</h3>
                <ul>
                    <li>Netfilter Project. (n.d.). <em>iptables man page</em>.</li>
                    <li>O'Reilly. (2009). <em>Linux Firewalls</em>.</li>
                </ul>
            </div>

        </section>
    </main>

    <button onclick="generatePDF()" class="pdf-btn" title="Exportar a PDF" aria-label="Exportar a PDF">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
    </button>

    <script>
        function generatePDF() {
            const element = document.getElementById('pdf-content');
            const opt = {
                margin: [10, 10, 10, 10],
                filename: 'AC03_iptables_Erik_DeLaRosa.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save();
        }
    </script>
</body>

</html>