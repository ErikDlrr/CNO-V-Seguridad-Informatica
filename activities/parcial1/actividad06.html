x
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AC06 - Implementación de IPSec VPN | Erik De La Rosa</title>
    <link rel="stylesheet" href="../../assets/styles.css" />

    <style>
        .table-wrap {
            overflow: auto;
            border-radius: 16px;
        }

        table.compare {
            width: 100%;
            border-collapse: collapse;
            min-width: 980px;
        }

        table.compare th,
        table.compare td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, .10);
            vertical-align: top;
            text-align: left;
        }

        table.compare th {
            position: sticky;
            top: 0;
            z-index: 1;
            background: rgba(0, 0, 0, .35);
            backdrop-filter: blur(6px);
        }

        .pill {
            display: inline-block;
            padding: 2px 10px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, .18);
            font-size: 12px;
            opacity: .95;
            white-space: nowrap;
        }

        .small {
            font-size: 12px;
            opacity: .78;
        }

        .callout {
            padding: 14px 16px;
            border-left: 3px solid rgba(255, 255, 255, .22);
            background: rgba(255, 255, 255, .05);
            border-radius: 12px;
            margin: 14px 0;
        }

        code.inline {
            padding: 2px 6px;
            border-radius: 8px;
            background: rgba(255, 255, 255, .08);
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: .95em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 14px;
            margin: 12px 0 18px;
        }

        .grid .card {
            grid-column: span 12;
        }

        @media (min-width: 960px) {
            .grid .card.half {
                grid-column: span 6;
            }

            .grid .card.third {
                grid-column: span 4;
            }
        }

        figure.media {
            margin: 0;
        }

        figure.media img {
            width: 100%;
            display: block;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, .10);
        }

        figure.media figcaption {
            margin-top: 8px;
            font-size: 12px;
            opacity: .78;
            line-height: 1.35;
        }

        .kbd {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, .16);
            background: rgba(255, 255, 255, .06);
        }

        .pkt-btn {
            bottom: 90px;
            background: rgba(14, 165, 233, 0.15);
            color: #0ea5e9;
            border: 1px solid rgba(14, 165, 233, 0.4);
            backdrop-filter: blur(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .pkt-btn:hover {
            background: rgba(14, 165, 233, 0.25);
            border-color: #0ea5e9;
            box-shadow: 0 0 15px rgba(14, 165, 233, 0.4);
            transform: translateY(-2px);
        }
    </style>
</head>

<body>
    <header class="topbar">
        <div class="container topbar__inner">
            <div class="brand">
                <a href="../../index.html#actividades" class="back-link">← Volver a Actividades</a>
            </div>
        </div>
        <div class="scanline" aria-hidden="true"></div>
    </header>

    <main class="article">
        <header class="article__header">
            <div class="article__meta">
                <span>CNO V - Seguridad Informática</span>
                <span>•</span>
                <span>Primer Parcial</span>
                <span>•</span>
                <span>Actividad 06</span>
            </div>

            <h1>Implementación de IPSec VPN (Site-to-Site) en Cisco Packet Tracer</h1>

            <p class="lead">
                Se implementó un túnel <strong>IPSec site-to-site</strong> entre dos redes LAN (192.168.1.0/24 y
                192.168.3.0/24)
                atravesando un “ISP” simulado. Se documenta la configuración, verificación con <span class="pill">ISAKMP
                    SA</span> /
                <span class="pill">IPSec SA</span>, evidencias y explicación de los comandos.
            </p>
        </header>



        <section class="article__content">

            <h2>1. Introducción</h2>
            <p>
                En escenarios reales, interconectar sucursales por Internet requiere confidencialidad e integridad.
                <strong>IPSec</strong> resuelve esto cifrando el tráfico entre gateways (routers), creando un túnel
                lógico
                “como si fuera una red privada” sobre una red pública.
            </p>

            <div class="callout">
                <b>Objetivo práctico:</b> lograr conectividad <b>LAN↔LAN</b> (PC1↔PC2) y comprobar que el tráfico viaja
                protegido
                por IPSec (SAs activas y contadores de encapsulación/descapsulación incrementando).
            </div>

            <h2>2. Topología y direccionamiento</h2>
            <ul>
                <li><b>LAN 1 (R1):</b> 192.168.1.0/24 (gateway típico: <code class="inline">192.168.1.1</code>)</li>
                <li><b>LAN 2 (R3):</b> 192.168.3.0/24 (gateway típico: <code class="inline">192.168.3.1</code>)</li>
                <li><b>WAN R1–ISP:</b> 209.165.100.0/30</li>
                <li><b>WAN R3–ISP:</b> 209.165.200.0/30</li>
            </ul>

            <div class="grid">
                <div class="card half" style="padding:14px;">
                    <figure class="media">
                        <!-- Ajusta la ruta real de tus imágenes -->
                        <img src="img/topografia.png" alt="Topología general de la práctica (IPSec VPN Tunnel)" />
                        <figcaption><b>Evidencia 01.</b> Topología general: R1 y R3 conectados a ISP y túnel IPSec entre
                            ambos.</figcaption>
                    </figure>
                </div>

                <div class="card half" style="padding:14px;">
                    <figure class="media">
                        <img src="img/isp.png" alt="Configuración del router ISP (rutas estáticas)" />
                        <figcaption><b>Evidencia 02.</b> Router ISP con rutas estáticas hacia 192.168.1.0/24 y
                            192.168.3.0/24.</figcaption>
                    </figure>
                </div>
            </div>

            <h2>3. ¿Por qué hubo que habilitar el módulo de seguridad (securityk9)?</h2>
            <p>
                En los routers Cisco (como los 1941 del laboratorio), las funciones criptográficas (ISAKMP/IKE, IPSec,
                transform-sets, etc.) dependen del paquete/licencia <code class="inline">securityk9</code>.
                Si el router arranca solo con <code class="inline">ipbasek9</code>, muchos comandos de <code
                    class="inline">crypto</code>
                no están disponibles o no operan correctamente.
            </p>

            <div class="callout">
                <b>En otras palabras:</b> sin <code class="inline">securityk9</code> no hay “motor” para cifrar el
                tráfico.
                Por eso se aplicó <code class="inline">license boot module c1900 technology-package securityk9</code> y
                se reinició
                para que el feature quede activo al arranque.
            </div>

            <div class="grid">
                <div class="card half" style="padding:14px;">
                    <figure class="media">
                        <img src="img/activacionSegR1.png" alt="Activación securityk9 en R1" />
                        <figcaption><b>Evidencia 03.</b> Activación de <code class="inline">securityk9</code> en R1
                            (aceptación y reload).</figcaption>
                    </figure>
                </div>

                <div class="card half" style="padding:14px;">
                    <figure class="media">
                        <img src="img/activacionSegR3.png" alt="Activación securityk9 en R3" />
                        <figcaption><b>Evidencia 04.</b> Activación de <code class="inline">securityk9</code> en R3
                            (boot license y reload).</figcaption>
                    </figure>
                </div>
            </div>

            <h2>4. Desarrollo técnico</h2>

            <h3>4.1 Configuración base de red (interfaces y rutas)</h3>
            <p>
                Se configuraron IPs en interfaces LAN/WAN y una ruta por defecto hacia el ISP (en R1 y R3).
                En el ISP se agregaron rutas estáticas hacia ambas LANs.
            </p>

            <div class="code-block">
                ! R1 - Base (ejemplo)
                hostname R1
                no ip domain-lookup
                interface g0/1
                ip address 192.168.1.1 255.255.255.0
                no shutdown
                interface g0/0
                ip address 209.165.100.1 255.255.255.252
                no shutdown
                ip route 0.0.0.0 0.0.0.0 209.165.100.2
            </div>

            <div class="code-block">
                ! R3 - Base (ejemplo)
                hostname R3
                no ip domain-lookup
                interface g0/1
                ip address 192.168.3.1 255.255.255.0
                no shutdown
                interface g0/0
                ip address 209.165.200.1 255.255.255.252
                no shutdown
                ip route 0.0.0.0 0.0.0.0 209.165.200.2
            </div>

            <div class="code-block">
                ! ISP - Rutas estáticas hacia las LAN
                hostname ISP
                no ip domain-lookup
                interface g0/0
                ip address 209.165.100.2 255.255.255.252
                no shutdown
                interface g0/1
                ip address 209.165.200.2 255.255.255.252
                no shutdown
                ip route 192.168.1.0 255.255.255.0 209.165.100.1
                ip route 192.168.3.0 255.255.255.0 209.165.200.1
            </div>

            <div class="grid">
                <div class="card third" style="padding:14px;">
                    <figure class="media">
                        <img src="img/r1.png" alt="Configuración base de R1 (interfaces y ruta default)" />
                        <figcaption><b>Evidencia 05.</b> R1: interfaces + ruta por defecto.</figcaption>
                    </figure>
                </div>

                <div class="card third" style="padding:14px;">
                    <figure class="media">
                        <img src="img/r3.png" alt="Configuración base de R3 (interfaces y ruta default)" />
                        <figcaption><b>Evidencia 06.</b> R3: interfaces + ruta por defecto.</figcaption>
                    </figure>
                </div>

                <div class="card third" style="padding:14px;">
                    <figure class="media">
                        <img src="img/version.png" alt="show version mostrando paquetes/licencias" />
                        <figcaption><b>Evidencia 07.</b> Verificación de IOS/paquetes (referencia de licencias y
                            modelo).</figcaption>
                    </figure>
                </div>
            </div>

            <h3>4.2 Configuración del túnel IPSec (IKE/ISAKMP + IPSec)</h3>
            <p>
                La VPN site-to-site se construye en dos capas:
            </p>
            <ul>
                <li><b>Fase 1 (IKE/ISAKMP):</b> negociación segura del canal de control (política, hash, cifrado,
                    autenticación).</li>
                <li><b>Fase 2 (IPSec):</b> define cómo se cifra el tráfico (transform-set) y qué tráfico entra al túnel
                    (ACL).</li>
            </ul>

            <div class="callout">
                Para que el túnel “suba”, ambos extremos deben coincidir en: política ISAKMP, clave precompartida,
                transform-set y ACL (interesante traffic). Si uno no coincide, verás SAs vacías o contadores en cero.
            </div>

            <div class="code-block">
                ! ===== R1 (lado LAN 192.168.1.0/24) =====
                conf t
                crypto isakmp policy 10
                encr aes
                hash sha
                authentication pre-share
                group 2
                lifetime 86400
                exit

                crypto isakmp key cisco address 209.165.200.1

                crypto ipsec transform-set VPN-SET esp-aes esp-sha-hmac

                access-list 110 permit ip 192.168.1.0 0.0.0.255 192.168.3.0 0.0.0.255

                crypto map VPN-MAP 10 ipsec-isakmp
                set peer 209.165.200.1
                set transform-set VPN-SET
                match address 110
                exit

                interface g0/0
                crypto map VPN-MAP
                end
                write
            </div>

            <div class="code-block">
                ! ===== R3 (lado LAN 192.168.3.0/24) =====
                conf t
                crypto isakmp policy 10
                encr aes
                hash sha
                authentication pre-share
                group 2
                lifetime 86400
                exit

                crypto isakmp key cisco address 209.165.100.1

                crypto ipsec transform-set VPN-SET esp-aes esp-sha-hmac

                access-list 110 permit ip 192.168.3.0 0.0.0.255 192.168.1.0 0.0.0.255

                crypto map VPN-MAP 10 ipsec-isakmp
                set peer 209.165.100.1
                set transform-set VPN-SET
                match address 110
                exit

                interface g0/0
                crypto map VPN-MAP
                end
                write
            </div>

            <div class="grid">
                <div class="card half" style="padding:14px;">
                    <figure class="media">
                        <img src="img/actR1VPN.png"
                            alt="Configuración VPN en R1 (crypto isakmp/ipsec/acl/crypto map)" />
                        <figcaption><b>Evidencia 08.</b> R1: configuración de VPN (ISAKMP + IPSec + ACL + crypto map).
                        </figcaption>
                    </figure>
                </div>

                <div class="card half" style="padding:14px;">
                    <figure class="media">
                        <img src="img/actR3VPN.png"
                            alt="Configuración VPN en R3 (crypto isakmp/ipsec/acl/crypto map)" />
                        <figcaption><b>Evidencia 09.</b> R3: configuración de VPN (ISAKMP + IPSec + ACL + crypto map).
                        </figcaption>
                    </figure>
                </div>
            </div>

            <h2>5. Tabla de comandos usados y para qué sirven</h2>
            <div class="card table-wrap" style="padding:0;">
                <table class="compare">
                    <thead>
                        <tr>
                            <th>Comando</th>
                            <th>¿Para qué sirve?</th>
                            <th>Notas / errores típicos</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code class="inline">enable</code></td>
                            <td>Entra a modo privilegiado para ejecutar comandos de verificación y configuración.</td>
                            <td>Si estás en <span class="kbd">R1(config)#</span>, primero usa <code
                                    class="inline">end</code> o <code class="inline">do</code>.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">conf t</code></td>
                            <td>Entra a modo de configuración global para aplicar cambios permanentes.</td>
                            <td>Si escribes mal: verás <span class="pill">Invalid input</span> o <span
                                    class="pill">Incomplete command</span>.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">interface g0/0</code> / <code class="inline">g0/1</code></td>
                            <td>Entra a la interfaz para asignar IP, habilitarla y/o aplicar el crypto map en la WAN.
                            </td>
                            <td>En esta práctica: <code class="inline">g0/0</code> fue WAN, <code
                                    class="inline">g0/1</code> fue LAN.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">ip address X Y</code></td>
                            <td>Asigna dirección IP y máscara a una interfaz.</td>
                            <td>Si la máscara no corresponde al /30 de WAN, se rompe el enrutamiento.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">no shutdown</code></td>
                            <td>Habilita físicamente la interfaz (sube el enlace).</td>
                            <td>Sin esto, la interfaz queda administratively down.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">ip route 0.0.0.0 0.0.0.0 NEXT-HOP</code></td>
                            <td>Ruta por defecto: envía tráfico “desconocido” hacia el ISP.</td>
                            <td>Si el next-hop está mal, no hay salida y no negocia la VPN.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">license boot module c1900 technology-package securityk9</code></td>
                            <td>Habilita el paquete criptográfico necesario para <code
                                    class="inline">crypto isakmp</code> e <code class="inline">ipsec</code>.</td>
                            <td>Requiere <code class="inline">write</code> y <code class="inline">reload</code>. Sin
                                esto, no hay VPN.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">crypto isakmp policy 10</code></td>
                            <td>Define la política IKE (Fase 1): cifrado, hash, autenticación, grupo DH, lifetime.</td>
                            <td>Ambos routers deben coincidir, o la negociación falla.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">crypto isakmp key cisco address PEER</code></td>
                            <td>Configura la clave precompartida para autenticar al peer IKE.</td>
                            <td>Si la clave/peer no coincide, la fase 1 no sube.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">crypto ipsec transform-set VPN-SET esp-aes esp-sha-hmac</code></td>
                            <td>Define cómo se protegerá el tráfico (ESP + cifrado AES + integridad SHA).</td>
                            <td>Si el transform-set no coincide, fase 2 falla.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">access-list 110 permit ip ...</code></td>
                            <td>Selecciona el “tráfico interesante” que se cifrará (LAN↔LAN).</td>
                            <td>Si pones redes equivocadas, el túnel puede subir pero no cifrar tráfico real.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">crypto map VPN-MAP 10 ipsec-isakmp</code></td>
                            <td>Une todo: peer, transform-set y ACL. Es la “política de túnel” aplicada a la WAN.</td>
                            <td>Sin crypto map aplicado en la WAN, no hay IPSec activo.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">interface g0/0</code> + <code
                                    class="inline">crypto map VPN-MAP</code></td>
                            <td>Aplica la VPN a la interfaz que mira a Internet (WAN).</td>
                            <td>Aplicarlo en la LAN es error típico.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">show crypto isakmp sa</code></td>
                            <td>Verifica la fase 1 (IKE). Estados como <span class="pill">QM_IDLE</span> indican
                                negociación completada.</td>
                            <td>Si está vacío o en estados raros, revisa policy/PSK/rutas.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">show crypto ipsec sa</code></td>
                            <td>Verifica la fase 2 (SAs IPSec) y contadores: <code class="inline">encaps/decaps</code>.
                            </td>
                            <td>Si encaps/decaps en 0, no está pasando “tráfico interesante”.</td>
                        </tr>

                        <tr>
                            <td><code class="inline">ping</code></td>
                            <td>Genera tráfico LAN↔LAN para “levantar” el túnel y confirmar conectividad.</td>
                            <td>El primer ping puede fallar mientras se negocia (normal).</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <p class="small">
                Tip útil: si estás en modo configuración (<span class="kbd">R1(config)#</span>) y quieres ejecutar un
                “show”,
                usa <code class="inline">do show ...</code> para no salir del modo.
            </p>

            <h2>6. Material multimedia</h2>

            <h3>6.1 Caso “aún no cifra” (referencia de error)</h3>
            <p>
                Cuando la VPN no está negociada o no hay tráfico interesante, puede verse sin SAs activas o con
                contadores en cero.
            </p>

            <div class="grid">
                <div class="card half" style="padding:14px;">
                    <figure class="media">
                        <img src="img/vpnNo.png" alt="Estado sin SAs activas o sin cifrado" />
                        <figcaption><b>Evidencia 10.</b> Señales típicas cuando todavía no hay túnel activo/contadores
                            incrementando.</figcaption>
                    </figure>
                </div>

                <div class="card half" style="padding:14px;">
                    <figure class="media">
                        <img src="img/isakmpIpsec.png" alt="show crypto isakmp sa y show crypto ipsec sa en R3" />
                        <figcaption><b>Evidencia 11.</b> Verificación en R3: IKE (QM_IDLE) e IPSec SA con estado ACTIVE.
                        </figcaption>
                    </figure>
                </div>
            </div>

            <h3>6.2 Caso correcto (túnel arriba y conectividad LAN↔LAN)</h3>
            <p>
                Con el túnel funcionando, se observan SAs en estado <b>ACTIVE</b> y contadores de <b>encaps/decaps</b>
                incrementando.
                Además, el ping entre hosts de ambas LAN responde.
            </p>

            <div class="grid">
                <div class="card half" style="padding:14px;">
                    <figure class="media">
                        <img src="img/pingcorrecto.png" alt="Ping correcto entre redes" />
                        <figcaption><b>Evidencia 12.</b> Prueba de conectividad: ping exitoso hacia la red remota.
                        </figcaption>
                    </figure>
                </div>

                <div class="card half" style="padding:14px;">
                    <figure class="media">
                        <img src="img/actR3VPN.png" alt="Configuración aplicada en R3" />
                        <figcaption><b>Evidencia 13.</b> Configuración final aplicada y guardada (write) en R3.
                        </figcaption>
                    </figure>
                </div>
            </div>

            <h2>7. Reflexión técnica</h2>
            <ul>
                <li>
                    La VPN no es “solo poner comandos”: si el <b>enrutamiento</b> está mal (default route / rutas en
                    ISP), IKE ni siquiera negocia.
                </li>
                <li>
                    <b>securityk9</b> no es un detalle: sin el paquete de seguridad, el router literalmente no puede
                    operar la parte criptográfica.
                </li>
                <li>
                    La forma más directa de validar IPSec no es “sentir que funciona”, sino ver <b>SAs ACTIVE</b> y
                    contadores
                    <code class="inline">encaps/decaps</code> subiendo al generar tráfico LAN↔LAN.
                </li>
                <li>
                    El primer ping puede fallar mientras se negocia: eso no es “error”, es el costo de levantar la fase
                    1 y 2.
                </li>
            </ul>

            <h2>8. Referencias técnicas</h2>
            <ul>
                <li>IPSec Architecture (RFC 4301).</li>
                <li>IKEv1 (RFC 2409) e ISAKMP (RFC 2408) como base conceptual de negociación.</li>
                <li>Documentación Cisco IOS: comandos <code class="inline">crypto isakmp</code> y <code
                        class="inline">crypto ipsec</code>.</li>
            </ul>

        </section>
    </main>

    <a href="act06_177700.pkt" class="pdf-btn pkt-btn" title="Descargar Práctica Packet Tracer (.pkt)" download>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
            <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
            <line x1="6" y1="6" x2="6.01" y2="6"></line>
            <line x1="6" y1="18" x2="6.01" y2="18"></line>
        </svg>
    </a>

    <a href="AC06P1.pdf" class="pdf-btn" title="Exportar a PDF" aria-label="Exportar a PDF" target="_blank"
        rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
    </a>

</body>

</html>